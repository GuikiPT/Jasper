generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

model GuildConfig {
    id              String                @id
    prefix          String?
    createdAt       DateTime              @default(now())
    updatedAt       DateTime              @updatedAt
    channels        GuildChannelSettings?
    roles           GuildRoleSettings?
    supportSettings GuildSupportSettings?
    supportTags     GuildSupportTag[]
    topics          GuildTopic[]
}

model GuildRoleSettings {
    guildId                String      @id
    allowedAdminRoles      Json
    allowedFunCommandRoles Json
    allowedStaffRoles      Json
    allowedTagAdminRoles   Json
    allowedTagRoles        Json
    ignoredSnipedRoles     Json
    supportRoles           Json
    guild                  GuildConfig @relation(fields: [guildId], references: [id], onDelete: Cascade)
}

model GuildChannelSettings {
    guildId                   String      @id
    allowedSkullboardChannels Json
    allowedSnipeChannels      Json
    allowedTagChannels        Json
    automaticSlowmodeChannels Json
    guild                     GuildConfig @relation(fields: [guildId], references: [id], onDelete: Cascade)
}

model GuildSupportTag {
    id               Int         @id @default(autoincrement())
    guildId          String
    name             String
    authorId         String
    editedBy         String?
    embedTitle       String      @db.VarChar(512)
    embedDescription String?     @db.Text
    embedFooter      String?     @db.Text
    embedImageUrl    String?     @db.VarChar(1024)
    createdAt        DateTime    @default(now())
    updatedAt        DateTime    @updatedAt
    GuildConfig      GuildConfig @relation(fields: [guildId], references: [id], onDelete: Cascade)

    @@unique([guildId, name])
    @@index([guildId])
    @@map("GuildSupportTags")
}

model GuildTopic {
    id          Int         @id @default(autoincrement())
    guildId     String
    value       String
    createdAt   DateTime    @default(now())
    updatedAt   DateTime    @updatedAt
    GuildConfig GuildConfig @relation(fields: [guildId], references: [id], onDelete: Cascade)

    @@unique([guildId, value])
    @@index([guildId])
    @@map("GuildTopics")
}

model GuildSupportSettings {
    guildId               String      @id
    supportForumChannelId String?
    resolvedTagId         String?
    guild                 GuildConfig @relation(fields: [guildId], references: [id], onDelete: Cascade)

    @@map("GuildSupportSettings")
}
